# Chapel Hill expert surveys 2019 Data Analysis

## **Project Description**

The Chapel Hill expert surveys estimate party positioning on European integration, ideology and policy issues for national parties in a variety of European countries. 

Total 32 EU countries and respective 277 political parties data collected to show a trend from 1999 to 2019. hapel hill expert survey(CHES) is lingest running, and most extensive expert survey on political parties in Europe.

Below are the data sets which was collected and generated by CHES team.

- [Chapel Hill Expert Survey dataset](https://www.chesdata.eu/s/CHES2019V3.csv) - This is survey datasets which countries, parties and thier orientation on different topics.

- [2019_CHES_codebook](https://static1.squarespace.com/static/5975c9bfdb29d6a05c65209b/t/5fa04ec05d3c8218b7c91450/1604341440585/2019_CHES_codebook.pdf) - This dataset provides the data for the 2019 Chapel Hill Expert Survey on the positioning of 277
political parties on political ideology, European integration, and policy positions in 32 countries,
including all EU member states.
    
    -  This PDF data contains country, country abbreviation, party and party's details such as name, abbreviation, id etc.
     
     
        `party.csv` and `country_abbr.csv` datasets are parsed from the pdf and kept in data folder. Ideal way would be if it is parsed from pdf itself but that is somthing #todo work at later stage.
    -   The pdf also contains orinetation details on differet features. 
    
        For instance for the column `EU_POSITION` represents overall orientation of the party leadership towards European integration in 2019.
    
                1 = Strongly opposed
                2 = Opposed
                3 = Somewhat opposed
                4 = Neutral
                5 = Somewhat in favor
                6 = In favor
                7 = Strongly in favor


- [Survey Questionnaire](https://static1.squarespace.com/static/5975c9bfdb29d6a05c65209b/t/5ed3029fe080e33f639e6e9a/1590887075513/CHES_UK_Qualtrics.pdf) - This dataset has general questions on various identified features and this is the end goal for the given dataset. For example if we see one of the question which ask- 

    **`How would you describe the general position on european integration that the party leadeship took during 2019?`**

    and then for the each country and for their respective polictical parties we need to find out the orientation on the scale of 1 to 7 to show how are they think on this matter?

    There are 42 such questions exists in this questionnaire which we need to answer.

## **Solution Description**

We now understand the project requirement at certain extent but atleast we know that we have few datasets. There are many ways to solve this problem but here we are more interested to solve it in Airflow way. 
If you want to check that how can we solve this problem without airflow then refer to this [repo](python-repo) which solve the problem in exact same way in plain python (no airflow)

So, to start with solution we know that we have to follow typical ETL workflow (extrat-transform-load). Once all required datasets are loaded and merged properly then we can build our report on the top of that. Solving it in airflow helps us
to leverage several inbuilt features such as logging, tracking, workflow management etc. 

The created dataflow will look like this 



## how to run same dag for multiple parameters

# Download the files from chapel hill expert survey to data folder

Code snippets are below

```python
files_uris = {"2019_CHES_codebook.pdf" : config.codebook_uri,
        "CHES2019V3.csv" : config.chesdata_uri, 
        "questionnaire.pdf" :config.questionnaire_uri
        }

for file, uri in enumerate(files_uris):
    file_name = file.split(":")[0
    task_download_data = PythonOperator(
        task_id=f"download_{file_name}",
        python_callable=download.download_files,
        op_kwargs={"uri": uri, "file_name": file_name},
        dag = dag
    )

    # parallelization of all download tasks.
    # This also can be written as start_operator >> task_download_data >> end_download_operators
    
    chain(start_operator, task_download_data, end_download_operators)
```

Why these three tasks, you might ask? Why not download the launches and corresponding pictures in one single task? Or why not split them into five tasks? After all, we have five arrows in John’s plan. These are all valid questions to ask while developing a workflow, but the truth is, there’s no right or wrong answer. There are several points to take into consideration, though, and throughout this book we work out many of these use cases to get a feeling for what is right and wrong. The code for this workflow is as follows.


